<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>MBO: MatVecBenchmark</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">MBO
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MatVecBenchmark<div class="ingroups"><a class="el" href="group__mbo__benchmarks.html">Benchmarks</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<dl class="section user"><dt></dt><dd>These benchmarks compare the performance of matrix vector multiplies using <a class="el" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b" title="Data type for numerical operators. ">MboNumOp</a> to assembled sparse matrix vector multiplies. The assembled matrices correspond to regular compressed sparse row (<a class="el" href="structCSR.html">CSR</a>) matrices. This matrix format is sometimes referred to as Yale formate.</dd></dl>
<h3>Performance model for assembled operator application</h3>
<dl class="section user"><dt></dt><dd>Operator application for assembled matrices is typically memory bandwidth limited. For each complex multiply-add we need to load at least <img class="formulaInl" alt="$(8+16)$" src="form_4.png"/> Byte. The first <img class="formulaInl" alt="$8$" src="form_5.png"/> Byte are for the column index of the non-zero. The second <img class="formulaInl" alt="$16$" src="form_6.png"/> Byte are the complex number for the non-zero entry in the matrix. Note that this estimate assumes that the right hand side values are caches which is not always the case. 24B per multiply add is thus an optimistic estimate. It corresponds to an arithmetic intensity of <img class="formulaInl" alt="$1/3$" src="form_7.png"/> floating point operations per Byte. For a stream bandwidth of <img class="formulaInl" alt="$ {\rm BW} $" src="form_8.png"/> we get <img class="formulaInl" alt="$ 1/3 ({\rm BW} / ({\rm GB}/{\rm s})) {\rm GFLOP}/{\rm s} $" src="form_9.png"/>.</dd></dl>
<h3>Performance model for <a class="el" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b" title="Data type for numerical operators. ">MboNumOp</a></h3>
<dl class="section user"><dt></dt><dd>The implementation of the matrix vector multiply inside of <a class="el" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b" title="Data type for numerical operators. ">MboNumOp</a> is going to evolve. Currently, this method is essentially streaming both source and destination vector for each simple operator. A simple operator in this context is a tensor product composed entirely of identities and individual sparse matrix entries. This means that the <a class="el" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b" title="Data type for numerical operators. ">MboNumOp</a> matrix vector multiply is largely memory bandwidth limited. In its current implementation we have an arithmetic intensity of <img class="formulaInl" alt="$1/4$" src="form_10.png"/>. The fact that this implementation is still slightly faster than the assembled matrix vector multiply despite being even more memory bandwidth bound is probably due to the more regular data access pattern. We avoid the indirect data accesses in the assembled matrix vector multiply.</dd></dl>
<dl class="section user"><dt></dt><dd>Before we start we need to bring the Mbo library into scop by including several headers. We need the main <a class="el" href="Mbo_8h.html" title="The core modules of the mbo library. ">Mbo.h</a> header as well as <a class="el" href="MboVec_8h.html" title="The MboVec API. ">MboVec.h</a></dd></dl>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Mbo_8h.html">Mbo.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="MboVec_8h.html">MboVec.h</a>&gt;</span></div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>In addition we need the following system headers</dd></dl>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>The following two functions are used to construct the <a class="el" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b" title="Data type for numerical operators. ">MboNumOp</a>'s needed in this benchmark. They are defined further down.</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> buildTavisCummingsHamiltonian(<span class="keywordtype">int</span> nAtoms, <span class="keywordtype">int</span> nPhotons);</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> buildJx(<span class="keywordtype">int</span> nAtoms);</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>The following function builds all operators we're using for the comparison. Currently we're using the many particle angular momentum operator <img class="formulaInl" alt="$J_x$" src="form_11.png"/> as well as the Tavis-Cummings Hamiltonian. <code>numOps</code> specifies the total number of operators that have been allocated in the <code>ops</code> array.</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> buildAllOps(<span class="keywordtype">int</span> numOps, <a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a>* ops)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> numPtclsJxMin = 8;</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> numPtclsJxMax = 18;</div>
<div class="line">        <span class="keywordflow">for</span> (i = numPtclsJxMin; i &lt; numPtclsJxMax; ++i) {</div>
<div class="line">                <span class="keywordflow">if</span> (numOps &lt;= 0) <span class="keywordflow">return</span>;</div>
<div class="line">                 *ops = buildJx(i);</div>
<div class="line">                ++ops;</div>
<div class="line">                --numOps;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; 10; ++i) {</div>
<div class="line">                <span class="keywordflow">if</span> (numOps &lt;= 0) <span class="keywordflow">return</span>;</div>
<div class="line">                 *ops = buildTavisCummingsHamiltonian(10 + i, 10);</div>
<div class="line">                ++ops;</div>
<div class="line">                --numOps;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> runBenchmark(<a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> op);</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>The benchmarks are run by simply creating the operators and then invoking runBenchmark on each one of them.</dd></dl>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">        <a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> *ops;</div>
<div class="line">        <span class="keywordtype">int</span> numOps = 20, i;</div>
<div class="line"></div>
<div class="line">        ops = (<a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a>*)malloc(numOps * <span class="keyword">sizeof</span>(*ops));</div>
<div class="line">        buildAllOps(numOps, ops);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; numOps; ++i) {</div>
<div class="line">                runBenchmark(ops[i]);</div>
<div class="line">        }</div>
</div><!-- fragment --><p>Here we release all resources associated with the operators.</p>
<div class="fragment"><div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; numOps; ++i) {</div>
<div class="line">                <a class="code" href="group__mbo__numop.html#ga4d5aee5ad92cf00edbccbcdfba759251">mboNumOpDestroy</a>(&amp;ops[i]);</div>
<div class="line">        }</div>
<div class="line">        free(ops);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>The <a class="el" href="structCSR.html">CSR</a> data structure defined in the following code is used to represent the assembled matrices. <code>dim</code> is the dimension of the matrix; <code>i</code> is an array with the offsets for the different rows; <code>j</code> are the column indices of the non-zero entries; and <code>a</code> are the non-zero values.</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="structCSR.html">CSR</a> {</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> dim;</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> *i;</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> *j;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> *a;</div>
<div class="line">};</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>The following function initializes a <a class="el" href="structCSR.html">CSR</a> structure in a well defined state.</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structCSR.html">CSR</a> createCSR()</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structCSR.html">CSR</a> csr;</div>
<div class="line">        csr.i = 0;</div>
<div class="line">        csr.j = 0;</div>
<div class="line">        csr.a = 0;</div>
<div class="line">        <span class="keywordflow">return</span> csr;</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>The following function deallocates all memory in a <a class="el" href="structCSR.html">CSR</a> matrix.</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> destroyCSR(<span class="keyword">struct</span> <a class="code" href="structCSR.html">CSR</a> *csr)</div>
<div class="line">{</div>
<div class="line">        free(csr-&gt;i);</div>
<div class="line">        free(csr-&gt;j);</div>
<div class="line">        free(csr-&gt;a);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd><code>getCSRMatrix</code> creates the <a class="el" href="structCSR.html">CSR</a> matrix corresponding to a <a class="el" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b" title="Data type for numerical operators. ">MboNumOp</a>. This function uses <a class="el" href="group__mbo__numop.html#ga18f6f5baad49d6693021e4fb6ef87968" title="Compute row offsets of sparse matrix. ">mboNumOpRowOffsets</a> and <a class="el" href="group__mbo__numop.html#gac660906a7ab2c03862347e9287a8a918" title="Create a sparse matrix representation for a numerical operator. ">mboNumOpSparseMatrix</a> to obtain the sparse matrix data. <code>csr</code> should have been previously created with <code>createCSR</code>.</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> getCSRMatrix(<a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> op, <span class="keyword">struct</span> <a class="code" href="structCSR.html">CSR</a> *csr)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#ga9ef2073619247462727165ef6f2f436f">MboProdSpace</a> h;</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> dim;</div>
<div class="line"></div>
<div class="line">        h = <a class="code" href="group__mbo__numop.html#ga0a8e65391decce03a68785a3c12cdf53">mboNumOpGetSpace</a>(op);</div>
<div class="line">        dim = <a class="code" href="group__mbo__prodspace.html#ga5a7beb3bfd56e91a294c30aa6912d0ed">mboProdSpaceDim</a>(h);</div>
<div class="line">        csr-&gt;dim = dim;</div>
<div class="line">        csr-&gt;i = malloc((dim + 1) * <span class="keyword">sizeof</span>(*csr-&gt;i));</div>
<div class="line">        <a class="code" href="group__mbo__numop.html#ga18f6f5baad49d6693021e4fb6ef87968">mboNumOpRowOffsets</a>(op, 0, dim, csr-&gt;i);</div>
<div class="line">        csr-&gt;j = malloc(csr-&gt;i[dim] * <span class="keyword">sizeof</span>(*csr-&gt;j));</div>
<div class="line">        csr-&gt;a = malloc(csr-&gt;i[dim] * <span class="keyword">sizeof</span>(*csr-&gt;a));</div>
<div class="line">        <a class="code" href="group__mbo__numop.html#gac660906a7ab2c03862347e9287a8a918">mboNumOpSparseMatrix</a>(op, 0, dim, csr-&gt;i, csr-&gt;j, csr-&gt;a);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd><code><a class="el" href="structBenchmarkData.html">BenchmarkData</a></code> is a simple container for the results from a benchmark run. It is used to record the execution times of several runs, storage requirements, and the number of floating point operations.</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> {</div>
<div class="line">        <span class="keywordtype">int</span> numIters;</div>
<div class="line">        <span class="keywordtype">double</span> *times;</div>
<div class="line">        <span class="keywordtype">double</span> storage;</div>
<div class="line">        <span class="keywordtype">double</span> numFlops;</div>
<div class="line">};</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>A <code>struct <a class="el" href="structBenchmarkData.html">BenchmarkData</a></code> can be initialized with the following function</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> createBenchmarkData(int numIters)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> bm;</div>
<div class="line">        bm.numIters = numIters;</div>
<div class="line">        bm.times = malloc(numIters * <span class="keyword">sizeof</span>(*bm.times));</div>
<div class="line">        bm.storage = 0;</div>
<div class="line">        bm.numFlops = 0;</div>
<div class="line">        <span class="keywordflow">return</span> bm;</div>
<div class="line">}</div>
</div><!-- fragment --><p>and it is destroyed with</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> destroyBenchmarkData(<span class="keyword">struct</span> <a class="code" href="structBenchmarkData.html">BenchmarkData</a> *bm)</div>
<div class="line">{</div>
<div class="line">        free(bm-&gt;times);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>A <a class="el" href="structCSR.html">CSR</a> matrix can be applied to a vector by means of the following function.</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> applyCSRMatrix(<span class="keyword">struct</span> <a class="code" href="structMboAmplitude.html">MboAmplitude</a> alpha, <span class="keyword">struct</span> <a class="code" href="structCSR.html">CSR</a> *csr,</div>
<div class="line">                           <span class="keyword">struct</span> <a class="code" href="structMboAmplitude.html">MboAmplitude</a> *x, <span class="keyword">struct</span> <a class="code" href="structMboAmplitude.html">MboAmplitude</a> beta,</div>
<div class="line">                           <span class="keyword">struct</span> <a class="code" href="structMboAmplitude.html">MboAmplitude</a> *y)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> row, col, i;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> tmp, tmpp;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (row = 0; row &lt; csr-&gt;dim; ++row) {</div>
<div class="line">                tmp.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = beta.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> * y[row].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> - beta.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> * y[row].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a>;</div>
<div class="line">                tmp.im = beta.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> * y[row].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> + beta.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> * y[row].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a>;</div>
<div class="line">                <span class="keywordflow">for</span> (i = csr-&gt;i[row]; i &lt; csr-&gt;i[row + 1]; ++i) {</div>
<div class="line">                        col = csr-&gt;j[i];</div>
<div class="line">                        tmpp.re = csr-&gt;a[i].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> * alpha.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> - csr-&gt;a[i].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> *</div>
<div class="line">                                alpha.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a>;</div>
<div class="line">                        tmpp.im = csr-&gt;a[i].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> * alpha.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> + csr-&gt;a[i].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> *</div>
<div class="line">                                alpha.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a>;</div>
<div class="line">                        tmp.re += x[col].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> * tmpp.re - x[col].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> * tmpp.im;</div>
<div class="line">                        tmp.im += x[col].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> * tmpp.im + x[col].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> * tmpp.re;</div>
<div class="line">                }</div>
<div class="line">                y[row].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = tmp.re;</div>
<div class="line">                y[row].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> = tmp.im;</div>
<div class="line">        }</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>This is a simple driver for timing the execution time of the matrix vector multiplication using assembled matrices. This driver simply invokes <code>applyCSRMatrix</code> repeatedly and records the execution time.</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> runAssembledBenchmark(<a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> op, int numIters)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structCSR.html">CSR</a> csr = createCSR();</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> bm = createBenchmarkData(numIters);</div>
<div class="line">        MboVec x, y;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> *xarr, *yarr, alpha, beta;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        clock_t tstart, tend;</div>
<div class="line"></div>
<div class="line">        getCSRMatrix(op, &amp;csr);</div>
<div class="line">        bm.numFlops = csr.i[csr.dim] * 8.0;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga519f9c4991430613de01c3539afb1b2c">mboVecCreate</a>(csr.dim, &amp;x);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga519f9c4991430613de01c3539afb1b2c">mboVecCreate</a>(csr.dim, &amp;y);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga9a448fe3c5140f81be87692e4a28f4b4">mboVecGetViewR</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga7568dd76db9dfb28cfa089b3d6673d11">mboVecGetViewRW</a>(y, &amp;yarr);</div>
<div class="line">        alpha.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = 2.7;</div>
<div class="line">        alpha.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> = 0.8;</div>
<div class="line">        beta.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = 2.1;</div>
<div class="line">        beta.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> = 0.9;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; numIters; ++i) {</div>
<div class="line">                tstart = clock();</div>
<div class="line">                applyCSRMatrix(alpha, &amp;csr, xarr, beta, yarr);</div>
<div class="line">                tend = clock();</div>
<div class="line">                bm.times[i] = (double)(tend - tstart) / CLOCKS_PER_SEC;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(y, &amp;yarr);</div>
<div class="line">        </div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gad17607371e864e6522cca3e146083c29">mboVecDestroy</a>(&amp;x);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gad17607371e864e6522cca3e146083c29">mboVecDestroy</a>(&amp;y);</div>
<div class="line">        destroyCSR(&amp;csr);</div>
<div class="line">        <span class="keywordflow">return</span> bm;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The driver for the <a class="el" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b" title="Data type for numerical operators. ">MboNumOp</a>'s is completely analogous:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> runMboBenchmark(<a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> op, int numIters)</div>
<div class="line">{</div>
<div class="line">        clock_t tstart, tend;</div>
<div class="line">        MboVec x, y;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> *xarr, *yarr, alpha, beta;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> bm = createBenchmarkData(numIters);</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> dim;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line">        dim = <a class="code" href="group__mbo__prodspace.html#ga5a7beb3bfd56e91a294c30aa6912d0ed">mboProdSpaceDim</a>(<a class="code" href="group__mbo__numop.html#ga0a8e65391decce03a68785a3c12cdf53">mboNumOpGetSpace</a>(op));</div>
<div class="line">        bm.numFlops = <a class="code" href="group__mbo__numop.html#ga6e66d51130a2c93c289fca9ef057b8c7">mboNumOpFlops</a>(op);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga519f9c4991430613de01c3539afb1b2c">mboVecCreate</a>(dim, &amp;x);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga519f9c4991430613de01c3539afb1b2c">mboVecCreate</a>(dim, &amp;y);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga9a448fe3c5140f81be87692e4a28f4b4">mboVecGetViewR</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga7568dd76db9dfb28cfa089b3d6673d11">mboVecGetViewRW</a>(y, &amp;yarr);</div>
<div class="line">        alpha.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = 2.7;</div>
<div class="line">        alpha.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> = 0.8;</div>
<div class="line">        beta.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = 2.1;</div>
<div class="line">        beta.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> = 0.9;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; numIters; ++i) {</div>
<div class="line">                tstart = clock();</div>
<div class="line">                <a class="code" href="group__mbo__numop.html#ga82b63bcc38d0ec449cbdb2172d46561d">mboNumOpMatVec</a>(alpha, op, xarr, beta, yarr);</div>
<div class="line">                tend = clock();</div>
<div class="line">                bm.times[i] = (double)(tend - tstart) / CLOCKS_PER_SEC;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(y, &amp;yarr);</div>
<div class="line">        </div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gad17607371e864e6522cca3e146083c29">mboVecDestroy</a>(&amp;x);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gad17607371e864e6522cca3e146083c29">mboVecDestroy</a>(&amp;y);</div>
<div class="line">        <span class="keywordflow">return</span> bm;</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>The average of several numbers is computed as follows. This can be used to get average run times for the different benchmarks.</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span> average(<span class="keyword">const</span> <span class="keywordtype">double</span> *x, <span class="keywordtype">int</span> n)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">double</span> avg = 0.0;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; n; ++i) {</div>
<div class="line">                avg += x[i];</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> avg / (double)n;</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>A pair of assembled/unassembled benchmarks is printed to the screen as follows</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> printBenchmarkReport(<span class="keyword">struct</span> <a class="code" href="structBenchmarkData.html">BenchmarkData</a> *assembledBM,</div>
<div class="line">                                 <span class="keyword">struct</span> <a class="code" href="structBenchmarkData.html">BenchmarkData</a> *mboBenchmark, <span class="keywordtype">int</span> valid)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">double</span> meanTimeAssembled, meanTimeMbo;</div>
<div class="line">        <span class="keywordtype">double</span> gflopsAssembled, gflopsMbo;</div>
<div class="line"></div>
<div class="line">        meanTimeAssembled = average(assembledBM-&gt;times, assembledBM-&gt;numIters);</div>
<div class="line">        meanTimeMbo = average(mboBenchmark-&gt;times, mboBenchmark-&gt;numIters);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        gflopsAssembled = assembledBM-&gt;numFlops / meanTimeAssembled / 1.0e9;</div>
<div class="line">        gflopsMbo = assembledBM-&gt;numFlops / meanTimeMbo / 1.0e9;</div>
<div class="line">        printf(<span class="stringliteral">&quot;%1.2lf (%1.2Es)   %1.2lf (%1.2Es)   %1.2lfx &quot;</span>, gflopsMbo,</div>
<div class="line">               meanTimeMbo, gflopsAssembled, meanTimeMbo,</div>
<div class="line">               meanTimeAssembled / meanTimeMbo);</div>
<div class="line">        <span class="keywordflow">if</span> (valid) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;[PASSED]\n&quot;</span>);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                printf(<span class="stringliteral">&quot;[FAILED]\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>To compute the error we use the L2 norm of the difference between two vectors:</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span> distance(MboVec x, MboVec y, <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> d)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> i;</div>
<div class="line">        <span class="keywordtype">double</span> dist = 0;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> diff, *xarr, *yarr;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga9a448fe3c5140f81be87692e4a28f4b4">mboVecGetViewR</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga9a448fe3c5140f81be87692e4a28f4b4">mboVecGetViewR</a>(y, &amp;yarr);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; d; ++i) {</div>
<div class="line">                diff.re = xarr[i].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> - yarr[i].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a>;</div>
<div class="line">                diff.im = xarr[i].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> - yarr[i].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a>;</div>
<div class="line">                dist += diff.re * diff.re + diff.im * diff.im;</div>
<div class="line">        }</div>
<div class="line">        dist = sqrt(dist);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(y, &amp;yarr);</div>
<div class="line">        <span class="keywordflow">return</span> dist;</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>The <code>verify</code> method compares the results obtained from the assembled operators and the unassembled operators in the L2 norm. If the error is "small enough" we return a nonzero value to indicate success.</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> verify(<a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> op)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> valid = 0;</div>
<div class="line">        MboVec x, yMboNumOp, yAssembled;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> *xarr, *yarr, alpha, beta;</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> dim;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structCSR.html">CSR</a> csr = createCSR();</div>
<div class="line">        <span class="keywordtype">double</span> error;</div>
<div class="line"></div>
<div class="line">        dim = <a class="code" href="group__mbo__prodspace.html#ga5a7beb3bfd56e91a294c30aa6912d0ed">mboProdSpaceDim</a>(<a class="code" href="group__mbo__numop.html#ga0a8e65391decce03a68785a3c12cdf53">mboNumOpGetSpace</a>(op));</div>
<div class="line">        alpha.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = 2.7;</div>
<div class="line">        alpha.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> = 0.8;</div>
<div class="line">        beta.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = 0;</div>
<div class="line">        beta.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> = 0;</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga519f9c4991430613de01c3539afb1b2c">mboVecCreate</a>(dim, &amp;x);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga22a18503b1c7b6f3bb9ea98aa5e7c293">mboVecSetRandom</a>(x);</div>
</div><!-- fragment --><p>Compute result with MboNumOp</p>
<div class="fragment"><div class="line"><a class="code" href="group__mbo__vec.html#ga519f9c4991430613de01c3539afb1b2c">mboVecCreate</a>(dim, &amp;yMboNumOp);</div>
<div class="line"><a class="code" href="group__mbo__vec.html#ga4961c8ae31ab028c8672e53eff43f0bc">mboVecSet</a>(&amp;beta, yMboNumOp);</div>
<div class="line"><a class="code" href="group__mbo__vec.html#ga9a448fe3c5140f81be87692e4a28f4b4">mboVecGetViewR</a>(x, &amp;xarr);</div>
<div class="line"><a class="code" href="group__mbo__vec.html#ga7568dd76db9dfb28cfa089b3d6673d11">mboVecGetViewRW</a>(yMboNumOp, &amp;yarr);</div>
<div class="line"><a class="code" href="group__mbo__numop.html#ga82b63bcc38d0ec449cbdb2172d46561d">mboNumOpMatVec</a>(alpha, op, xarr, beta, yarr);</div>
<div class="line"><a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(x, &amp;xarr);</div>
<div class="line"><a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(yMboNumOp, &amp;yarr);</div>
</div><!-- fragment --><p>Compute result with assembled operator</p>
<div class="fragment"><div class="line">        <a class="code" href="group__mbo__vec.html#ga519f9c4991430613de01c3539afb1b2c">mboVecCreate</a>(dim, &amp;yAssembled);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga4961c8ae31ab028c8672e53eff43f0bc">mboVecSet</a>(&amp;beta, yAssembled);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga9a448fe3c5140f81be87692e4a28f4b4">mboVecGetViewR</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga7568dd76db9dfb28cfa089b3d6673d11">mboVecGetViewRW</a>(yAssembled, &amp;yarr);</div>
<div class="line">        getCSRMatrix(op, &amp;csr);</div>
<div class="line">        applyCSRMatrix(alpha, &amp;csr, xarr, beta, yarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(yAssembled, &amp;yarr);</div>
<div class="line"></div>
<div class="line">        error = distance(yMboNumOp, yAssembled, dim) / sqrt((<span class="keywordtype">double</span>)dim);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gad17607371e864e6522cca3e146083c29">mboVecDestroy</a>(&amp;x);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gad17607371e864e6522cca3e146083c29">mboVecDestroy</a>(&amp;yMboNumOp);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gad17607371e864e6522cca3e146083c29">mboVecDestroy</a>(&amp;yAssembled);</div>
<div class="line">        destroyCSR(&amp;csr);</div>
<div class="line"></div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> TOLERANCE = 1.0e-10;</div>
<div class="line">        <span class="keywordflow">if</span> (error &gt; TOLERANCE) {</div>
<div class="line">                valid = 0;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                valid = 1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> valid;</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>Running of the benchmarks, verification, and reporting for a given operator is orchestrated as follows:</dd></dl>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> runBenchmark(<a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> op)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> numIters = 2;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> assembledBenchmark =</div>
<div class="line">            runAssembledBenchmark(op, numIters);</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> mboBenchmark = runMboBenchmark(op, numIters);</div>
<div class="line">        <span class="keywordtype">int</span> operatorValid = verify(op);</div>
<div class="line">        printBenchmarkReport(&amp;assembledBenchmark, &amp;mboBenchmark, operatorValid);</div>
<div class="line">        destroyBenchmarkData(&amp;assembledBenchmark);</div>
<div class="line">        destroyBenchmarkData(&amp;mboBenchmark);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>Resonance frequency of ith atom used in the construction of the Tavis-Cummings Hamiltonian below. This is an entirely arbitrary choice</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span> omega(<span class="keywordtype">int</span> i)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">return</span> 1.3 * i;</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>Finally, the last two functions are used to construct the operators in the benchmark.</dd></dl>
<div class="fragment"><div class="line"><a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> buildTavisCummingsHamiltonian(<span class="keywordtype">int</span> nAtoms, <span class="keywordtype">int</span> nPhotons)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#ga9ef2073619247462727165ef6f2f436f">MboProdSpace</a> hSingleAtom, hAtoms, hField, hTot;</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#ga3bc079fb6656f649809d7cd7d6e8ddb5">MboElemOp</a> sm, sp, sz, a, ad, numberOp;</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga80e92cba3a8e5df5f0cee2132f5bf50a">MboTensorOp</a> inhomogeneousJz, jPlus, jMinus, idField, idAtoms, A, Ad, N,</div>
<div class="line">            H, *factors;</div>
<div class="line">        <a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> H_compiled;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> tmp;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        <a class="code" href="group__mbo__errors.html#ga37b5d6e8277b2da9e0f501d3c933136b">MBO_STATUS</a> err;</div>
</div><!-- fragment --><p>build various Hilbert spaces</p>
<div class="fragment"><div class="line">hSingleAtom = <a class="code" href="group__mbo__prodspace.html#ga9bc4dc9dea009614fb28072287b4d04c">mboProdSpaceCreate</a>(2);</div>
<div class="line">hAtoms = <a class="code" href="group__mbo__prodspace.html#ga9bc4dc9dea009614fb28072287b4d04c">mboProdSpaceCreate</a>(0);</div>
<div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; nAtoms; ++i) {</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gac4a23fb7961b9e3d59b98da7e7fcd7f5">mboProdSpaceMul</a>(hSingleAtom, &amp;hAtoms);</div>
<div class="line">}</div>
<div class="line">hField = <a class="code" href="group__mbo__prodspace.html#ga9bc4dc9dea009614fb28072287b4d04c">mboProdSpaceCreate</a>(nPhotons + 1);</div>
<div class="line">hTot = <a class="code" href="group__mbo__prodspace.html#ga9bc4dc9dea009614fb28072287b4d04c">mboProdSpaceCreate</a>(0);</div>
<div class="line"><a class="code" href="group__mbo__prodspace.html#gac4a23fb7961b9e3d59b98da7e7fcd7f5">mboProdSpaceMul</a>(hAtoms, &amp;hTot);</div>
<div class="line"><a class="code" href="group__mbo__prodspace.html#gac4a23fb7961b9e3d59b98da7e7fcd7f5">mboProdSpaceMul</a>(hField, &amp;hTot);</div>
</div><!-- fragment --><p>build atomic operators</p>
<div class="fragment"><div class="line">sm = <a class="code" href="group__mbo__elemop.html#gab97be6f5030d00bd0328c1bc0efc26e2">mboSigmaMinus</a>();</div>
<div class="line">sp = <a class="code" href="group__mbo__elemop.html#gabe936a829bea9d2f0e380a66e39b473a">mboSigmaPlus</a>();</div>
<div class="line">sz = <a class="code" href="group__mbo__elemop.html#ga654bd5824a574a137fb084ee81e4f6bd">mboSigmaZ</a>();</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hAtoms, &amp;inhomogeneousJz);</div>
<div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; nAtoms; ++i) {</div>
<div class="line">        tmp.re = omega(i);</div>
<div class="line">        tmp.im = 0;</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga91470b74cbd8ae3009b4b9f8430b2087">mboTensorOpAddScaledTo</a>(&amp;tmp, sz, i, inhomogeneousJz);</div>
<div class="line">}</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hAtoms, &amp;jMinus);</div>
<div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; nAtoms; ++i) {</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga0ed0e1991025ca578bd335cb806c8161">mboTensorOpAddTo</a>(sm, i, jMinus);</div>
<div class="line">}</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hAtoms, &amp;jPlus);</div>
<div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; nAtoms; ++i) {</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga0ed0e1991025ca578bd335cb806c8161">mboTensorOpAddTo</a>(sp, i, jPlus);</div>
<div class="line">}</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#ga4987a0d58e37b003218c1b19fa4c5532">mboTensorOpIdentity</a>(hAtoms, &amp;idAtoms);</div>
</div><!-- fragment --><p>build field operators</p>
<div class="fragment"><div class="line">a = <a class="code" href="group__mbo__elemop.html#gaf983a154011c3e23f28f459efb776365">mboAnnihilationOp</a>(nPhotons + 1);</div>
<div class="line">ad = <a class="code" href="group__mbo__elemop.html#ga8c5c957be261e580e7d8a834899a99fb">mboCreationOp</a>(nPhotons + 1);</div>
<div class="line">numberOp = <a class="code" href="group__mbo__elemop.html#ga75157e8a6f777f5e84e85d49cb4cc55c">mboNumOp</a>(nPhotons + 1);</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hField, &amp;A);</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#ga0ed0e1991025ca578bd335cb806c8161">mboTensorOpAddTo</a>(a, 0, A);</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hField, &amp;Ad);</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#ga0ed0e1991025ca578bd335cb806c8161">mboTensorOpAddTo</a>(ad, 0, Ad);</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hField, &amp;N);</div>
</div><!-- fragment --><p>The frequency of the cavity</p>
<div class="fragment"><div class="line">tmp.re = 2.7;</div>
<div class="line">tmp.im = 0;</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#ga91470b74cbd8ae3009b4b9f8430b2087">mboTensorOpAddScaledTo</a>(&amp;tmp, numberOp, 0, N);</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#ga4987a0d58e37b003218c1b19fa4c5532">mboTensorOpIdentity</a>(hField, &amp;idField);</div>
</div><!-- fragment --><p>Assemble Hamiltonian</p>
<div class="fragment"><div class="line">factors = malloc(2 * <span class="keyword">sizeof</span>(*factors));</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hTot, &amp;H);</div>
<div class="line">factors[0] = idField;</div>
<div class="line">factors[1] = inhomogeneousJz;</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#gae2f2756990a2473f2bf70a22a0d2ff08">mboTensorOpKron</a>(2, factors, &amp;H);</div>
<div class="line">factors[0] = N;</div>
<div class="line">factors[1] = idAtoms;</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#gae2f2756990a2473f2bf70a22a0d2ff08">mboTensorOpKron</a>(2, factors, &amp;H);</div>
<div class="line">factors[0] = A;</div>
<div class="line">factors[1] = jPlus;</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#gae2f2756990a2473f2bf70a22a0d2ff08">mboTensorOpKron</a>(2, factors, &amp;H);</div>
<div class="line">factors[0] = Ad;</div>
<div class="line">factors[1] = jMinus;</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#gae2f2756990a2473f2bf70a22a0d2ff08">mboTensorOpKron</a>(2, factors, &amp;H);</div>
<div class="line">free(factors);</div>
<div class="line"></div>
<div class="line">err = <a class="code" href="group__mbo__numop.html#ga3e171847ef05333a913818f6328b650e">mboNumOpCompile</a>(H, &amp;H_compiled);</div>
<div class="line">assert(err == MBO_SUCCESS);</div>
</div><!-- fragment --><p>Release all resources</p>
<div class="fragment"><div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;sm);</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;sp);</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;sz);</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;a);</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;ad);</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;numberOp);</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gaf85a2ef200e7de8ace7f2cefc73e5feb">mboProdSpaceDestroy</a>(&amp;hSingleAtom);</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gaf85a2ef200e7de8ace7f2cefc73e5feb">mboProdSpaceDestroy</a>(&amp;hAtoms);</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gaf85a2ef200e7de8ace7f2cefc73e5feb">mboProdSpaceDestroy</a>(&amp;hField);</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gaf85a2ef200e7de8ace7f2cefc73e5feb">mboProdSpaceDestroy</a>(&amp;hTot);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;inhomogeneousJz);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;jMinus);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;jPlus);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;idAtoms);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;A);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;Ad);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;N);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;idField);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;H);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> H_compiled;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> buildJx(<span class="keywordtype">int</span> nAtoms)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#ga9ef2073619247462727165ef6f2f436f">MboProdSpace</a> hSingleAtom, hAtoms;</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#ga3bc079fb6656f649809d7cd7d6e8ddb5">MboElemOp</a> sm, sp;</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga80e92cba3a8e5df5f0cee2132f5bf50a">MboTensorOp</a> Jx;</div>
<div class="line">        <a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> Jx_compiled;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> tmp;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        <a class="code" href="group__mbo__errors.html#ga37b5d6e8277b2da9e0f501d3c933136b">MBO_STATUS</a> err;</div>
</div><!-- fragment --><p>build various Hilbert spaces</p>
<div class="fragment"><div class="line">hSingleAtom = <a class="code" href="group__mbo__prodspace.html#ga9bc4dc9dea009614fb28072287b4d04c">mboProdSpaceCreate</a>(2);</div>
<div class="line">hAtoms = <a class="code" href="group__mbo__prodspace.html#ga9bc4dc9dea009614fb28072287b4d04c">mboProdSpaceCreate</a>(0);</div>
<div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; nAtoms; ++i) {</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gac4a23fb7961b9e3d59b98da7e7fcd7f5">mboProdSpaceMul</a>(hSingleAtom, &amp;hAtoms);</div>
<div class="line">}</div>
</div><!-- fragment --><p>build atomic operators</p>
<div class="fragment"><div class="line">sm = <a class="code" href="group__mbo__elemop.html#gab97be6f5030d00bd0328c1bc0efc26e2">mboSigmaMinus</a>();</div>
<div class="line">sp = <a class="code" href="group__mbo__elemop.html#gabe936a829bea9d2f0e380a66e39b473a">mboSigmaPlus</a>();</div>
<div class="line"><a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hAtoms, &amp;Jx);</div>
<div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; nAtoms; ++i) {</div>
<div class="line">        tmp.re = 0.5;</div>
<div class="line">        tmp.im = 0;</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga91470b74cbd8ae3009b4b9f8430b2087">mboTensorOpAddScaledTo</a>(&amp;tmp, sm, i, Jx);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga91470b74cbd8ae3009b4b9f8430b2087">mboTensorOpAddScaledTo</a>(&amp;tmp, sp, i, Jx);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">err = <a class="code" href="group__mbo__numop.html#ga3e171847ef05333a913818f6328b650e">mboNumOpCompile</a>(Jx, &amp;Jx_compiled);</div>
<div class="line">assert(err == MBO_SUCCESS);</div>
</div><!-- fragment --><p>Release all resources</p>
<div class="fragment"><div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;sm);</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;sp);</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gaf85a2ef200e7de8ace7f2cefc73e5feb">mboProdSpaceDestroy</a>(&amp;hSingleAtom);</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gaf85a2ef200e7de8ace7f2cefc73e5feb">mboProdSpaceDestroy</a>(&amp;hAtoms);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;Jx);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> Jx_compiled;</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Plain source code</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Mbo_8h.html">Mbo.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="MboVec_8h.html">MboVec.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> buildTavisCummingsHamiltonian(<span class="keywordtype">int</span> nAtoms, <span class="keywordtype">int</span> nPhotons);</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> buildJx(<span class="keywordtype">int</span> nAtoms);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> buildAllOps(<span class="keywordtype">int</span> numOps, <a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a>* ops)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> numPtclsJxMin = 8;</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> numPtclsJxMax = 18;</div>
<div class="line">        <span class="keywordflow">for</span> (i = numPtclsJxMin; i &lt; numPtclsJxMax; ++i) {</div>
<div class="line">                <span class="keywordflow">if</span> (numOps &lt;= 0) <span class="keywordflow">return</span>;</div>
<div class="line">                 *ops = buildJx(i);</div>
<div class="line">                ++ops;</div>
<div class="line">                --numOps;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; 10; ++i) {</div>
<div class="line">                <span class="keywordflow">if</span> (numOps &lt;= 0) <span class="keywordflow">return</span>;</div>
<div class="line">                 *ops = buildTavisCummingsHamiltonian(10 + i, 10);</div>
<div class="line">                ++ops;</div>
<div class="line">                --numOps;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> runBenchmark(<a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> op);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">        <a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> *ops;</div>
<div class="line">        <span class="keywordtype">int</span> numOps = 20, i;</div>
<div class="line"></div>
<div class="line">        ops = (<a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a>*)malloc(numOps * <span class="keyword">sizeof</span>(*ops));</div>
<div class="line">        buildAllOps(numOps, ops);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; numOps; ++i) {</div>
<div class="line">                runBenchmark(ops[i]);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; numOps; ++i) {</div>
<div class="line">                <a class="code" href="group__mbo__numop.html#ga4d5aee5ad92cf00edbccbcdfba759251">mboNumOpDestroy</a>(&amp;ops[i]);</div>
<div class="line">        }</div>
<div class="line">        free(ops);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span><a class="code" href="structCSR.html">CSR</a> {</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> dim;</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> *i;</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> *j;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> *a;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structCSR.html">CSR</a> createCSR()</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structCSR.html">CSR</a> csr;</div>
<div class="line">        csr.i = 0;</div>
<div class="line">        csr.j = 0;</div>
<div class="line">        csr.a = 0;</div>
<div class="line">        <span class="keywordflow">return</span> csr;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> destroyCSR(<span class="keyword">struct</span> <a class="code" href="structCSR.html">CSR</a> *csr)</div>
<div class="line">{</div>
<div class="line">        free(csr-&gt;i);</div>
<div class="line">        free(csr-&gt;j);</div>
<div class="line">        free(csr-&gt;a);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> getCSRMatrix(<a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> op, <span class="keyword">struct</span> <a class="code" href="structCSR.html">CSR</a> *csr)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#ga9ef2073619247462727165ef6f2f436f">MboProdSpace</a> h;</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> dim;</div>
<div class="line"></div>
<div class="line">        h = <a class="code" href="group__mbo__numop.html#ga0a8e65391decce03a68785a3c12cdf53">mboNumOpGetSpace</a>(op);</div>
<div class="line">        dim = <a class="code" href="group__mbo__prodspace.html#ga5a7beb3bfd56e91a294c30aa6912d0ed">mboProdSpaceDim</a>(h);</div>
<div class="line">        csr-&gt;dim = dim;</div>
<div class="line">        csr-&gt;i = malloc((dim + 1) * <span class="keyword">sizeof</span>(*csr-&gt;i));</div>
<div class="line">        <a class="code" href="group__mbo__numop.html#ga18f6f5baad49d6693021e4fb6ef87968">mboNumOpRowOffsets</a>(op, 0, dim, csr-&gt;i);</div>
<div class="line">        csr-&gt;j = malloc(csr-&gt;i[dim] * <span class="keyword">sizeof</span>(*csr-&gt;j));</div>
<div class="line">        csr-&gt;a = malloc(csr-&gt;i[dim] * <span class="keyword">sizeof</span>(*csr-&gt;a));</div>
<div class="line">        <a class="code" href="group__mbo__numop.html#gac660906a7ab2c03862347e9287a8a918">mboNumOpSparseMatrix</a>(op, 0, dim, csr-&gt;i, csr-&gt;j, csr-&gt;a);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> {</div>
<div class="line">        <span class="keywordtype">int</span> numIters;</div>
<div class="line">        <span class="keywordtype">double</span> *times;</div>
<div class="line">        <span class="keywordtype">double</span> storage;</div>
<div class="line">        <span class="keywordtype">double</span> numFlops;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> createBenchmarkData(int numIters)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> bm;</div>
<div class="line">        bm.numIters = numIters;</div>
<div class="line">        bm.times = malloc(numIters * <span class="keyword">sizeof</span>(*bm.times));</div>
<div class="line">        bm.storage = 0;</div>
<div class="line">        bm.numFlops = 0;</div>
<div class="line">        <span class="keywordflow">return</span> bm;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> destroyBenchmarkData(<span class="keyword">struct</span> <a class="code" href="structBenchmarkData.html">BenchmarkData</a> *bm)</div>
<div class="line">{</div>
<div class="line">        free(bm-&gt;times);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> applyCSRMatrix(<span class="keyword">struct</span> <a class="code" href="structMboAmplitude.html">MboAmplitude</a> alpha, <span class="keyword">struct</span> <a class="code" href="structCSR.html">CSR</a> *csr,</div>
<div class="line">                           <span class="keyword">struct</span> <a class="code" href="structMboAmplitude.html">MboAmplitude</a> *x, <span class="keyword">struct</span> <a class="code" href="structMboAmplitude.html">MboAmplitude</a> beta,</div>
<div class="line">                           <span class="keyword">struct</span> <a class="code" href="structMboAmplitude.html">MboAmplitude</a> *y)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> row, col, i;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> tmp, tmpp;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (row = 0; row &lt; csr-&gt;dim; ++row) {</div>
<div class="line">                tmp.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = beta.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> * y[row].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> - beta.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> * y[row].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a>;</div>
<div class="line">                tmp.im = beta.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> * y[row].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> + beta.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> * y[row].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a>;</div>
<div class="line">                <span class="keywordflow">for</span> (i = csr-&gt;i[row]; i &lt; csr-&gt;i[row + 1]; ++i) {</div>
<div class="line">                        col = csr-&gt;j[i];</div>
<div class="line">                        tmpp.re = csr-&gt;a[i].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> * alpha.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> - csr-&gt;a[i].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> *</div>
<div class="line">                                alpha.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a>;</div>
<div class="line">                        tmpp.im = csr-&gt;a[i].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> * alpha.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> + csr-&gt;a[i].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> *</div>
<div class="line">                                alpha.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a>;</div>
<div class="line">                        tmp.re += x[col].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> * tmpp.re - x[col].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> * tmpp.im;</div>
<div class="line">                        tmp.im += x[col].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> * tmpp.im + x[col].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> * tmpp.re;</div>
<div class="line">                }</div>
<div class="line">                y[row].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = tmp.re;</div>
<div class="line">                y[row].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> = tmp.im;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> runAssembledBenchmark(<a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> op, int numIters)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structCSR.html">CSR</a> csr = createCSR();</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> bm = createBenchmarkData(numIters);</div>
<div class="line">        MboVec x, y;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> *xarr, *yarr, alpha, beta;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        clock_t tstart, tend;</div>
<div class="line"></div>
<div class="line">        getCSRMatrix(op, &amp;csr);</div>
<div class="line">        bm.numFlops = csr.i[csr.dim] * 8.0;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga519f9c4991430613de01c3539afb1b2c">mboVecCreate</a>(csr.dim, &amp;x);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga519f9c4991430613de01c3539afb1b2c">mboVecCreate</a>(csr.dim, &amp;y);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga9a448fe3c5140f81be87692e4a28f4b4">mboVecGetViewR</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga7568dd76db9dfb28cfa089b3d6673d11">mboVecGetViewRW</a>(y, &amp;yarr);</div>
<div class="line">        alpha.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = 2.7;</div>
<div class="line">        alpha.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> = 0.8;</div>
<div class="line">        beta.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = 2.1;</div>
<div class="line">        beta.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> = 0.9;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; numIters; ++i) {</div>
<div class="line">                tstart = clock();</div>
<div class="line">                applyCSRMatrix(alpha, &amp;csr, xarr, beta, yarr);</div>
<div class="line">                tend = clock();</div>
<div class="line">                bm.times[i] = (double)(tend - tstart) / CLOCKS_PER_SEC;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(y, &amp;yarr);</div>
<div class="line">        </div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gad17607371e864e6522cca3e146083c29">mboVecDestroy</a>(&amp;x);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gad17607371e864e6522cca3e146083c29">mboVecDestroy</a>(&amp;y);</div>
<div class="line">        destroyCSR(&amp;csr);</div>
<div class="line">        <span class="keywordflow">return</span> bm;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> runMboBenchmark(<a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> op, int numIters)</div>
<div class="line">{</div>
<div class="line">        clock_t tstart, tend;</div>
<div class="line">        MboVec x, y;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> *xarr, *yarr, alpha, beta;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> bm = createBenchmarkData(numIters);</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> dim;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line">        dim = <a class="code" href="group__mbo__prodspace.html#ga5a7beb3bfd56e91a294c30aa6912d0ed">mboProdSpaceDim</a>(<a class="code" href="group__mbo__numop.html#ga0a8e65391decce03a68785a3c12cdf53">mboNumOpGetSpace</a>(op));</div>
<div class="line">        bm.numFlops = <a class="code" href="group__mbo__numop.html#ga6e66d51130a2c93c289fca9ef057b8c7">mboNumOpFlops</a>(op);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga519f9c4991430613de01c3539afb1b2c">mboVecCreate</a>(dim, &amp;x);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga519f9c4991430613de01c3539afb1b2c">mboVecCreate</a>(dim, &amp;y);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga9a448fe3c5140f81be87692e4a28f4b4">mboVecGetViewR</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga7568dd76db9dfb28cfa089b3d6673d11">mboVecGetViewRW</a>(y, &amp;yarr);</div>
<div class="line">        alpha.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = 2.7;</div>
<div class="line">        alpha.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> = 0.8;</div>
<div class="line">        beta.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = 2.1;</div>
<div class="line">        beta.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> = 0.9;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; numIters; ++i) {</div>
<div class="line">                tstart = clock();</div>
<div class="line">                <a class="code" href="group__mbo__numop.html#ga82b63bcc38d0ec449cbdb2172d46561d">mboNumOpMatVec</a>(alpha, op, xarr, beta, yarr);</div>
<div class="line">                tend = clock();</div>
<div class="line">                bm.times[i] = (double)(tend - tstart) / CLOCKS_PER_SEC;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(y, &amp;yarr);</div>
<div class="line">        </div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gad17607371e864e6522cca3e146083c29">mboVecDestroy</a>(&amp;x);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gad17607371e864e6522cca3e146083c29">mboVecDestroy</a>(&amp;y);</div>
<div class="line">        <span class="keywordflow">return</span> bm;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span> average(<span class="keyword">const</span> <span class="keywordtype">double</span> *x, <span class="keywordtype">int</span> n)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">double</span> avg = 0.0;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; n; ++i) {</div>
<div class="line">                avg += x[i];</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> avg / (double)n;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> printBenchmarkReport(<span class="keyword">struct</span> <a class="code" href="structBenchmarkData.html">BenchmarkData</a> *assembledBM,</div>
<div class="line">                                 <span class="keyword">struct</span> <a class="code" href="structBenchmarkData.html">BenchmarkData</a> *mboBenchmark, <span class="keywordtype">int</span> valid)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">double</span> meanTimeAssembled, meanTimeMbo;</div>
<div class="line">        <span class="keywordtype">double</span> gflopsAssembled, gflopsMbo;</div>
<div class="line"></div>
<div class="line">        meanTimeAssembled = average(assembledBM-&gt;times, assembledBM-&gt;numIters);</div>
<div class="line">        meanTimeMbo = average(mboBenchmark-&gt;times, mboBenchmark-&gt;numIters);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        gflopsAssembled = assembledBM-&gt;numFlops / meanTimeAssembled / 1.0e9;</div>
<div class="line">        gflopsMbo = assembledBM-&gt;numFlops / meanTimeMbo / 1.0e9;</div>
<div class="line">        printf(<span class="stringliteral">&quot;%1.2lf (%1.2Es)   %1.2lf (%1.2Es)   %1.2lfx &quot;</span>, gflopsMbo,</div>
<div class="line">               meanTimeMbo, gflopsAssembled, meanTimeMbo,</div>
<div class="line">               meanTimeAssembled / meanTimeMbo);</div>
<div class="line">        <span class="keywordflow">if</span> (valid) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;[PASSED]\n&quot;</span>);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                printf(<span class="stringliteral">&quot;[FAILED]\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span> distance(MboVec x, MboVec y, <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> d)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> i;</div>
<div class="line">        <span class="keywordtype">double</span> dist = 0;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> diff, *xarr, *yarr;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga9a448fe3c5140f81be87692e4a28f4b4">mboVecGetViewR</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga9a448fe3c5140f81be87692e4a28f4b4">mboVecGetViewR</a>(y, &amp;yarr);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; d; ++i) {</div>
<div class="line">                diff.re = xarr[i].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> - yarr[i].<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a>;</div>
<div class="line">                diff.im = xarr[i].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> - yarr[i].<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a>;</div>
<div class="line">                dist += diff.re * diff.re + diff.im * diff.im;</div>
<div class="line">        }</div>
<div class="line">        dist = sqrt(dist);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(y, &amp;yarr);</div>
<div class="line">        <span class="keywordflow">return</span> dist;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> verify(<a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> op)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> valid = 0;</div>
<div class="line">        MboVec x, yMboNumOp, yAssembled;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> *xarr, *yarr, alpha, beta;</div>
<div class="line">        <a class="code" href="group__mbo__indices.html#gaa1d8f92a1a73cbb37e322162120ea917">MboGlobInd</a> dim;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structCSR.html">CSR</a> csr = createCSR();</div>
<div class="line">        <span class="keywordtype">double</span> error;</div>
<div class="line"></div>
<div class="line">        dim = <a class="code" href="group__mbo__prodspace.html#ga5a7beb3bfd56e91a294c30aa6912d0ed">mboProdSpaceDim</a>(<a class="code" href="group__mbo__numop.html#ga0a8e65391decce03a68785a3c12cdf53">mboNumOpGetSpace</a>(op));</div>
<div class="line">        alpha.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = 2.7;</div>
<div class="line">        alpha.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> = 0.8;</div>
<div class="line">        beta.<a class="code" href="structMboAmplitude.html#aba099cb22559d3830ba3761eb4f12587">re</a> = 0;</div>
<div class="line">        beta.<a class="code" href="structMboAmplitude.html#a4792b57f80d371bf308de5a683838cc0">im</a> = 0;</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga519f9c4991430613de01c3539afb1b2c">mboVecCreate</a>(dim, &amp;x);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga22a18503b1c7b6f3bb9ea98aa5e7c293">mboVecSetRandom</a>(x);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga519f9c4991430613de01c3539afb1b2c">mboVecCreate</a>(dim, &amp;yMboNumOp);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga4961c8ae31ab028c8672e53eff43f0bc">mboVecSet</a>(&amp;beta, yMboNumOp);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga9a448fe3c5140f81be87692e4a28f4b4">mboVecGetViewR</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga7568dd76db9dfb28cfa089b3d6673d11">mboVecGetViewRW</a>(yMboNumOp, &amp;yarr);</div>
<div class="line">        <a class="code" href="group__mbo__numop.html#ga82b63bcc38d0ec449cbdb2172d46561d">mboNumOpMatVec</a>(alpha, op, xarr, beta, yarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(yMboNumOp, &amp;yarr);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga519f9c4991430613de01c3539afb1b2c">mboVecCreate</a>(dim, &amp;yAssembled);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga4961c8ae31ab028c8672e53eff43f0bc">mboVecSet</a>(&amp;beta, yAssembled);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga9a448fe3c5140f81be87692e4a28f4b4">mboVecGetViewR</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#ga7568dd76db9dfb28cfa089b3d6673d11">mboVecGetViewRW</a>(yAssembled, &amp;yarr);</div>
<div class="line">        getCSRMatrix(op, &amp;csr);</div>
<div class="line">        applyCSRMatrix(alpha, &amp;csr, xarr, beta, yarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(x, &amp;xarr);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gaac2a610b0276ac900b2acc23bddaecaf">mboVecReleaseView</a>(yAssembled, &amp;yarr);</div>
<div class="line"></div>
<div class="line">        error = distance(yMboNumOp, yAssembled, dim) / sqrt((<span class="keywordtype">double</span>)dim);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gad17607371e864e6522cca3e146083c29">mboVecDestroy</a>(&amp;x);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gad17607371e864e6522cca3e146083c29">mboVecDestroy</a>(&amp;yMboNumOp);</div>
<div class="line">        <a class="code" href="group__mbo__vec.html#gad17607371e864e6522cca3e146083c29">mboVecDestroy</a>(&amp;yAssembled);</div>
<div class="line">        destroyCSR(&amp;csr);</div>
<div class="line"></div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> TOLERANCE = 1.0e-10;</div>
<div class="line">        <span class="keywordflow">if</span> (error &gt; TOLERANCE) {</div>
<div class="line">                valid = 0;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                valid = 1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> valid;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> runBenchmark(<a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> op)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> numIters = 2;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> assembledBenchmark =</div>
<div class="line">            runAssembledBenchmark(op, numIters);</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structBenchmarkData.html">BenchmarkData</a> mboBenchmark = runMboBenchmark(op, numIters);</div>
<div class="line">        <span class="keywordtype">int</span> operatorValid = verify(op);</div>
<div class="line">        printBenchmarkReport(&amp;assembledBenchmark, &amp;mboBenchmark, operatorValid);</div>
<div class="line">        destroyBenchmarkData(&amp;assembledBenchmark);</div>
<div class="line">        destroyBenchmarkData(&amp;mboBenchmark);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span> omega(<span class="keywordtype">int</span> i)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">return</span> 1.3 * i;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> buildTavisCummingsHamiltonian(<span class="keywordtype">int</span> nAtoms, <span class="keywordtype">int</span> nPhotons)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#ga9ef2073619247462727165ef6f2f436f">MboProdSpace</a> hSingleAtom, hAtoms, hField, hTot;</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#ga3bc079fb6656f649809d7cd7d6e8ddb5">MboElemOp</a> sm, sp, sz, a, ad, numberOp;</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga80e92cba3a8e5df5f0cee2132f5bf50a">MboTensorOp</a> inhomogeneousJz, jPlus, jMinus, idField, idAtoms, A, Ad, N,</div>
<div class="line">            H, *factors;</div>
<div class="line">        <a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> H_compiled;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> tmp;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        <a class="code" href="group__mbo__errors.html#ga37b5d6e8277b2da9e0f501d3c933136b">MBO_STATUS</a> err;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        hSingleAtom = <a class="code" href="group__mbo__prodspace.html#ga9bc4dc9dea009614fb28072287b4d04c">mboProdSpaceCreate</a>(2);</div>
<div class="line">        hAtoms = <a class="code" href="group__mbo__prodspace.html#ga9bc4dc9dea009614fb28072287b4d04c">mboProdSpaceCreate</a>(0);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; nAtoms; ++i) {</div>
<div class="line">                <a class="code" href="group__mbo__prodspace.html#gac4a23fb7961b9e3d59b98da7e7fcd7f5">mboProdSpaceMul</a>(hSingleAtom, &amp;hAtoms);</div>
<div class="line">        }</div>
<div class="line">        hField = <a class="code" href="group__mbo__prodspace.html#ga9bc4dc9dea009614fb28072287b4d04c">mboProdSpaceCreate</a>(nPhotons + 1);</div>
<div class="line">        hTot = <a class="code" href="group__mbo__prodspace.html#ga9bc4dc9dea009614fb28072287b4d04c">mboProdSpaceCreate</a>(0);</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gac4a23fb7961b9e3d59b98da7e7fcd7f5">mboProdSpaceMul</a>(hAtoms, &amp;hTot);</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gac4a23fb7961b9e3d59b98da7e7fcd7f5">mboProdSpaceMul</a>(hField, &amp;hTot);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        sm = <a class="code" href="group__mbo__elemop.html#gab97be6f5030d00bd0328c1bc0efc26e2">mboSigmaMinus</a>();</div>
<div class="line">        sp = <a class="code" href="group__mbo__elemop.html#gabe936a829bea9d2f0e380a66e39b473a">mboSigmaPlus</a>();</div>
<div class="line">        sz = <a class="code" href="group__mbo__elemop.html#ga654bd5824a574a137fb084ee81e4f6bd">mboSigmaZ</a>();</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hAtoms, &amp;inhomogeneousJz);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; nAtoms; ++i) {</div>
<div class="line">                tmp.re = omega(i);</div>
<div class="line">                tmp.im = 0;</div>
<div class="line">                <a class="code" href="group__mbo__tensorop.html#ga91470b74cbd8ae3009b4b9f8430b2087">mboTensorOpAddScaledTo</a>(&amp;tmp, sz, i, inhomogeneousJz);</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hAtoms, &amp;jMinus);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; nAtoms; ++i) {</div>
<div class="line">                <a class="code" href="group__mbo__tensorop.html#ga0ed0e1991025ca578bd335cb806c8161">mboTensorOpAddTo</a>(sm, i, jMinus);</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hAtoms, &amp;jPlus);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; nAtoms; ++i) {</div>
<div class="line">                <a class="code" href="group__mbo__tensorop.html#ga0ed0e1991025ca578bd335cb806c8161">mboTensorOpAddTo</a>(sp, i, jPlus);</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga4987a0d58e37b003218c1b19fa4c5532">mboTensorOpIdentity</a>(hAtoms, &amp;idAtoms);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        a = <a class="code" href="group__mbo__elemop.html#gaf983a154011c3e23f28f459efb776365">mboAnnihilationOp</a>(nPhotons + 1);</div>
<div class="line">        ad = <a class="code" href="group__mbo__elemop.html#ga8c5c957be261e580e7d8a834899a99fb">mboCreationOp</a>(nPhotons + 1);</div>
<div class="line">        numberOp = <a class="code" href="group__mbo__elemop.html#ga75157e8a6f777f5e84e85d49cb4cc55c">mboNumOp</a>(nPhotons + 1);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hField, &amp;A);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga0ed0e1991025ca578bd335cb806c8161">mboTensorOpAddTo</a>(a, 0, A);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hField, &amp;Ad);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga0ed0e1991025ca578bd335cb806c8161">mboTensorOpAddTo</a>(ad, 0, Ad);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hField, &amp;N);</div>
<div class="line"></div>
<div class="line">        tmp.re = 2.7;</div>
<div class="line">        tmp.im = 0;</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga91470b74cbd8ae3009b4b9f8430b2087">mboTensorOpAddScaledTo</a>(&amp;tmp, numberOp, 0, N);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga4987a0d58e37b003218c1b19fa4c5532">mboTensorOpIdentity</a>(hField, &amp;idField);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        factors = malloc(2 * <span class="keyword">sizeof</span>(*factors));</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hTot, &amp;H);</div>
<div class="line">        factors[0] = idField;</div>
<div class="line">        factors[1] = inhomogeneousJz;</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#gae2f2756990a2473f2bf70a22a0d2ff08">mboTensorOpKron</a>(2, factors, &amp;H);</div>
<div class="line">        factors[0] = N;</div>
<div class="line">        factors[1] = idAtoms;</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#gae2f2756990a2473f2bf70a22a0d2ff08">mboTensorOpKron</a>(2, factors, &amp;H);</div>
<div class="line">        factors[0] = A;</div>
<div class="line">        factors[1] = jPlus;</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#gae2f2756990a2473f2bf70a22a0d2ff08">mboTensorOpKron</a>(2, factors, &amp;H);</div>
<div class="line">        factors[0] = Ad;</div>
<div class="line">        factors[1] = jMinus;</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#gae2f2756990a2473f2bf70a22a0d2ff08">mboTensorOpKron</a>(2, factors, &amp;H);</div>
<div class="line">        free(factors);</div>
<div class="line"></div>
<div class="line">        err = <a class="code" href="group__mbo__numop.html#ga3e171847ef05333a913818f6328b650e">mboNumOpCompile</a>(H, &amp;H_compiled);</div>
<div class="line">        assert(err == MBO_SUCCESS);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;sm);</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;sp);</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;sz);</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;a);</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;ad);</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;numberOp);</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gaf85a2ef200e7de8ace7f2cefc73e5feb">mboProdSpaceDestroy</a>(&amp;hSingleAtom);</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gaf85a2ef200e7de8ace7f2cefc73e5feb">mboProdSpaceDestroy</a>(&amp;hAtoms);</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gaf85a2ef200e7de8ace7f2cefc73e5feb">mboProdSpaceDestroy</a>(&amp;hField);</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gaf85a2ef200e7de8ace7f2cefc73e5feb">mboProdSpaceDestroy</a>(&amp;hTot);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;inhomogeneousJz);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;jMinus);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;jPlus);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;idAtoms);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;A);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;Ad);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;N);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;idField);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;H);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> H_compiled;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> buildJx(<span class="keywordtype">int</span> nAtoms)</div>
<div class="line">{</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#ga9ef2073619247462727165ef6f2f436f">MboProdSpace</a> hSingleAtom, hAtoms;</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#ga3bc079fb6656f649809d7cd7d6e8ddb5">MboElemOp</a> sm, sp;</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga80e92cba3a8e5df5f0cee2132f5bf50a">MboTensorOp</a> Jx;</div>
<div class="line">        <a class="code" href="group__mbo__numop.html#ga97b47799cc26a7637152bd2f29606a8b">MboNumOp</a> Jx_compiled;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structMboAmplitude.html">MboAmplitude</a> tmp;</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line">        <a class="code" href="group__mbo__errors.html#ga37b5d6e8277b2da9e0f501d3c933136b">MBO_STATUS</a> err;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        hSingleAtom = <a class="code" href="group__mbo__prodspace.html#ga9bc4dc9dea009614fb28072287b4d04c">mboProdSpaceCreate</a>(2);</div>
<div class="line">        hAtoms = <a class="code" href="group__mbo__prodspace.html#ga9bc4dc9dea009614fb28072287b4d04c">mboProdSpaceCreate</a>(0);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; nAtoms; ++i) {</div>
<div class="line">                <a class="code" href="group__mbo__prodspace.html#gac4a23fb7961b9e3d59b98da7e7fcd7f5">mboProdSpaceMul</a>(hSingleAtom, &amp;hAtoms);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        sm = <a class="code" href="group__mbo__elemop.html#gab97be6f5030d00bd0328c1bc0efc26e2">mboSigmaMinus</a>();</div>
<div class="line">        sp = <a class="code" href="group__mbo__elemop.html#gabe936a829bea9d2f0e380a66e39b473a">mboSigmaPlus</a>();</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#gaf9e342dc31acaf8b38f842c990e185be">mboTensorOpNull</a>(hAtoms, &amp;Jx);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; nAtoms; ++i) {</div>
<div class="line">                tmp.re = 0.5;</div>
<div class="line">                tmp.im = 0;</div>
<div class="line">                <a class="code" href="group__mbo__tensorop.html#ga91470b74cbd8ae3009b4b9f8430b2087">mboTensorOpAddScaledTo</a>(&amp;tmp, sm, i, Jx);</div>
<div class="line">                <a class="code" href="group__mbo__tensorop.html#ga91470b74cbd8ae3009b4b9f8430b2087">mboTensorOpAddScaledTo</a>(&amp;tmp, sp, i, Jx);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        err = <a class="code" href="group__mbo__numop.html#ga3e171847ef05333a913818f6328b650e">mboNumOpCompile</a>(Jx, &amp;Jx_compiled);</div>
<div class="line">        assert(err == MBO_SUCCESS);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;sm);</div>
<div class="line">        <a class="code" href="group__mbo__elemop.html#gab8cef26a5c6ef8eed05a6666bf439917">mboElemOpDestroy</a>(&amp;sp);</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gaf85a2ef200e7de8ace7f2cefc73e5feb">mboProdSpaceDestroy</a>(&amp;hSingleAtom);</div>
<div class="line">        <a class="code" href="group__mbo__prodspace.html#gaf85a2ef200e7de8ace7f2cefc73e5feb">mboProdSpaceDestroy</a>(&amp;hAtoms);</div>
<div class="line">        <a class="code" href="group__mbo__tensorop.html#ga834e3a69aec1dbaf1c1e712a3d308e59">mboTensorOpDestroy</a>(&amp;Jx);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> Jx_compiled;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
